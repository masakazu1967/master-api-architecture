# mastering api architecture

O'REILLY マスタリングAPIアーキテクチャのケーススタディのカンファレンスシステム

カンファレンスシステムのレガシーと呼ばれるモノリスアプリケーションがあります。
Webアプリケーションの後にAPIコントローラがあり、内部に出席者、講演、予約の主要な3モジュールとデータストアといった、典型的な3層アーキテクチャで構成されています。
レガシーカンファレンスシステムはプライベートデータセンター上で稼働しています。

カンファレンス主催者から改善要望が発生しました。

- モバイルアプリケーションの提供
- システムをグローバルに展開し、カンファレンスを年1回ではなく数十回開催することを検討しています。
- 併せて外部システムの公募システム(Call For Papers)と統合して、カンファレンスで登壇する人の申請を管理します。
- プライベートデータセンターを廃止して、クラウドプラットフォーム上でカンファレンスシステムを運用したいと考えています。

既存の本番システムに影響を与えることなく、徐々に機能を移行することを考えています。

パブリッククラウド、データセンター、ハイブリットアプローチのいずれでも対応できるモデルと抽象化が必要となります。
サービスをAPIとして提供することにより通信を抽象化することができ、API利用者とAPI提供者の間のプロセス外通信を検討することが可能になります。

主要３モジュールのうち、最初にアクセスが集中し、依存関係が少ない出席者(Attendee)コンポーネントをサービスとして切り出します。

利用者からレガシーカンファレンスシステムへの通信は外部トラフィックからのインバウンド通信です。
利用者が利用しているUIからインターネット経由でレガシーカンファレンスシステムにリクエストを送信します。
レガシーカンファレンスシステムのリクエストを受け付けるポイントがユーザーからのエンドポイントです。このエンドポイントはインターネットに公開されています。
アクセスするユーザーを認証し、リクエストが認可された要求であるか検証する必要があります。

レガシーカンファレンスシステムとAttendeeサービスの間に存在する新しい通信は内部トラフィックを表しています。
レガシーカンファレンスシステムからのリクエストであるため、レガシーカンファレンスへのリクエストは適切に認証と認可を経由して通信されているため、比較的安全です。
しかし、セキュリティは検討する必要があります。

外部トラフィックはトラフィック管理を行う必要があります。通常APIゲートウェイによって制御されます。
内部トラフィックはサービスメッシュによって処理されます。
これらの処理を行うサービスとしてKubernetesやIstioがあります。これらのサービスは通信を抽象化することにより柔軟にサービス館の通信を行います。
